#!/bin/bash
## @author Copyright (C) 2016 Robin Schneider <ypid@riseup.net>
## @license GPL-3.0 <https://www.gnu.org/licenses/gpl-3.0.html>

## Generate URL definitions of all Ansible modules in RST.

set -e

echo '.. Ansible modules [[[
.. This section was generated by: https://github.com/debops/docs/blob/master/docs/docs/bin/gen_ansible_modules_rst_defs
'

## dev/testing: `ansible-doc -l` needs to be cached because it is that freaking slow.
# test -f "/tmp/ansible_module.list" || ansible-doc -l 2>/dev/null > "/tmp/ansible_module.list"
# cut -d ' ' -f 1 "/tmp/ansible_module.list" | while read -r ansible_module_name

ansible-doc -l 2>/dev/null | cut -d ' ' -f 1 | while read -r ansible_module_name
do
    if [[ "$ansible_module_name" == "DEPRECATED:" ]]
    then
        echo ".. Deprecated modules follow:"
    else
        echo ".. _Ansible ${ansible_module_name} module: https://docs.ansible.com/ansible/${ansible_module_name}_module.html"
    fi
done

echo '.. ]]]'
